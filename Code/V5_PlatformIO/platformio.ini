; PlatformIO Project Configuration File for Ash-Nazg Melty Brain Robot
; Board: Adafruit QT Py ESP32-S3 WiFi Dev Board with STEMMA QT - 8 MB Flash / No PSRAM
; Dual-core; DShot on Core 1 for steady timing
;
; ============ UPLOAD INSTRUCTIONS (Qt Py ESP32-S3) ============
; USB: 1. Put board in boot mode: Hold BOOT, press RESET, release BOOT
;      2. Run: pio run -t upload   (or use env "upload_ota" for WiFi)
;      3. After upload, press RESET
;
; WiFi (OTA): 1. Put robot in WiFi mode (CH5 high so it runs wifi_mode())
;             2. Connect PC to robot's AP: SSID "Beyblade", password "meltybrain"
;             3. Run: pio run -e upload_ota -t upload
;             (Robot IP in AP mode is 192.168.4.1; OTA password in code is "admin")
;
; ============ USEFUL COMMANDS ============
; Build only:           pio run
; Upload (USB):        pio run -t upload
; Upload (WiFi OTA):   pio run -e upload_ota -t upload
; Serial Monitor:      pio device monitor
; Clean:               pio run -t clean
; ==========================================

[env:adafruit_qtpy_esp32s3_nopsram]
platform = espressif32
board = adafruit_qtpy_esp32s3_nopsram
framework = arduino
upload_port = COM9
upload_speed = 921600
monitor_port = COM10
monitor_speed = 115200
lib_extra_dirs = ../Libraries
lib_deps =
    https://github.com/ZZ-Cat/CRSFforArduino.git
    https://github.com/adafruit/Adafruit_DotStar.git
build_flags =
    -DCORE_DEBUG_LEVEL=0
    -DARDUINO_USB_CDC_ON_BOOT=1
board_build.partitions = min_spiffs.csv

; ---------- WiFi OTA upload (use when robot is in WiFi mode on "Beyblade" AP) ----------
[env:upload_ota]
platform = espressif32
board = adafruit_qtpy_esp32s3_nopsram
framework = arduino
upload_protocol = espota
upload_port = 192.168.4.1
upload_flags = --auth=admin
lib_extra_dirs = ../Libraries
lib_deps =
    https://github.com/ZZ-Cat/CRSFforArduino.git
    https://github.com/adafruit/Adafruit_DotStar.git
build_flags =
    -DCORE_DEBUG_LEVEL=0
    -DARDUINO_USB_CDC_ON_BOOT=1
board_build.partitions = min_spiffs.csv
